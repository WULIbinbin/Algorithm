(function(f,c){typeof exports=="object"&&typeof module<"u"?c(exports):typeof define=="function"&&define.amd?define(["exports"],c):(f=typeof globalThis<"u"?globalThis:f||self,c(f.es={}))})(this,function(f){"use strict";function c(t,e="undefined"){return Object.prototype.toString.call(t)===`[object ${e[0].toUpperCase()}${e.substring(1)}]`}const u="pending",a="fulfilled",h="rejected";function n(t){const e=this;this.PromiseState=u,this.PromiseResult=void 0,this.onFulfilledCallBack=[],this.onRejectedCallBack=[];try{if(!c(t,"function"))throw new Error("\u8BF7\u6DFB\u52A0\u56DE\u8C03\u51FD\u6570");t(i,s)}catch(o){s(o)}function i(o){e.PromiseState===u&&(e.PromiseState=a,e.PromiseResult=o,e.onFulfilledCallBack.forEach(r=>r(o)))}function s(o){e.PromiseState===u&&(e.PromiseState=h,e.PromiseResult=o,e.onRejectedCallBack.forEach(r=>r(o)))}}n.prototype.then=function(e,i){c(e,"function")||(e=o=>o),c(i,"function")||(i=o=>o);const s=new n((o,r)=>{const d=()=>{try{setTimeout(()=>{const l=e(this.PromiseResult);m(s,l,o,r)})}catch(l){r(l)}},p=()=>{try{setTimeout(()=>{const l=i(this.PromiseResult);m(s,l,o,r)})}catch(l){r(l)}};this.PromiseState===u&&(this.onFulfilledCallBack.push(d),this.onRejectedCallBack.push(p)),this.PromiseState===a&&d(),this.PromiseState===h&&p()});return s};function m(t,e,i,s){if(t===e)throw new Error("\u4E0D\u80FD\u8FD4\u56DE\u81EA\u8EAB");e instanceof n?e.then(i,s):i(e)}n.resolve=function(e){return e instanceof n?e:new n(i=>{i(e)})},n.reject=function(e){return new n((i,s)=>{s(e)})};const P=new n((t,e)=>{setTimeout(()=>{t("promise------1")},2e3)}),y=new n((t,e)=>{try{setTimeout(()=>{console.log(that.add()),t("promise------2")},2e3)}catch(i){e(i)}}),w=()=>new n((t,e)=>{setTimeout(()=>{t("promise------3")},1e3)});P.then(t=>(console.log("res1",t),w())).then(t=>{console.log("res1_1",t)}),y.then(t=>{console.log("res2",t)},t=>{console.log("err2",t)});const S=n;f.MyPromise=S,Object.defineProperties(f,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
