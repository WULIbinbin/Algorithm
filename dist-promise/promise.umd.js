(function(r,c){typeof exports=="object"&&typeof module!="undefined"?module.exports=c():typeof define=="function"&&define.amd?define(c):(r=typeof globalThis!="undefined"?globalThis:r||self,r.promise=c())})(this,function(){"use strict";function r(s,t="undefined"){return Object.prototype.toString.call(s)===`[object ${t[0].toUpperCase()}${t.substring(1)}]`}const c="pending",h="fulfilled",d="rejected";function f(s){const t=this;this.PromiseState=c,this.PromiseResult=void 0,this.onFulfilledCallBack=[],this.onRejectedCallBack=[];try{if(!r(s,"function"))throw new Error("\u8BF7\u6DFB\u52A0\u56DE\u8C03\u51FD\u6570");s(n,o)}catch(e){o(e)}function n(e){t.PromiseState===c&&(t.PromiseState=h,t.PromiseResult=e,t.onFulfilledCallBack.forEach(i=>i(e)))}function o(e){t.PromiseState===c&&(t.PromiseState=d,t.PromiseResult=e,t.onRejectedCallBack.forEach(i=>i(e)))}}f.prototype.then=function(t,n){r(t,"function")||(t=e=>e),r(n,"function")||(n=e=>{throw e});const o=new f((e,i)=>{const l=()=>{setTimeout(()=>{try{const u=t(this.PromiseResult);a(o,u,e,i)}catch(u){i(u)}})},m=()=>{setTimeout(()=>{try{const u=n(this.PromiseResult);a(o,u,e,i)}catch(u){i(u)}})};this.PromiseState===c&&(this.onFulfilledCallBack.push(l),this.onRejectedCallBack.push(m)),this.PromiseState===h&&l(),this.PromiseState===d&&m()});return o};function a(s,t,n,o){if(s===t)throw new TypeError("Chaining cycle:\u4E0D\u80FD\u8FD4\u56DE\u81EA\u8EAB");if(t&&(r(t,"object")||r(t,"function"))){let e=!1;try{const{then:i}=t;if(r(i,"function"))i.call(t,l=>{e||(e=!0,a(s,l,n,o))},l=>{e||(e=!0,o(l))});else{if(e)return;e=!0,n(t)}}catch(i){if(e)return;e=!0,o(i)}}else n(t)}return f.resolve=function(t){return t instanceof f?t:new f(n=>{n(t)})},f.reject=function(t){return new f((n,o)=>{o(t)})},f});
